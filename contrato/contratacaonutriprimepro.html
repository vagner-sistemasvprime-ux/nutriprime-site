<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Contrata√ß√£o NutriPrime</title>
<style>
  body { font-family: 'Segoe UI', sans-serif; background: #f3f9f4; padding: 20px; }
  .form-box { max-width: 700px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 12px; border-left: 10px solid #81c784; border-right: 10px solid #81c784; box-shadow: 0 6px 20px rgba(0,0,0,0.1);}
  h2 { color: #2e7d32; text-align: center; }
  label { display: block; margin-top: 15px; font-weight: bold; color: #2e7d32; font-size: 14px; }
  input, select { width: 100%; padding: 12px; font-size: 16px; margin-top: 5px; border: 1.5px solid #c8e6c9; border-radius: 8px; box-sizing: border-box; }
  button { background-color: #66bb6a; color: #fff; font-weight: bold; border: none; border-radius: 8px; padding: 15px 20px; font-size: 20px; cursor: pointer; margin-top: 25px; width: 100%; }
  button:hover { background-color: #43a047; }
  #status { text-align: center; margin-top: 20px; font-weight: bold; color: #2e7d32; }
  #modalContrato { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background-color: rgba(0,0,0,0.6); z-index: 9999; }
  .modal-content { background:#fff; margin:5% auto; padding:20px 30px; width:90%; max-width:800px; border-radius:8px; max-height:80vh; overflow:hidden; display:flex; flex-direction:column; }
  #contratoTexto { flex:1 1 auto; overflow-y:auto; padding-right:15px; border:1px solid #ccc; border-radius:6px; margin-bottom:15px; white-space: pre-wrap; font-size:14px; line-height:1.5; }
  #botaoAceitar { display:none; flex-shrink:0; }
</style>
</head>
<body>
<div class="form-box">
  <h2>Finalizar Contrata√ß√£o do Sistema NUTRIPRIME</h2>
  <label>Nome completo*</label><input type="text" id="nome" required />
  <label>CPF ou CNPJ*</label><input type="text" id="documento" required />
  <label>Endere√ßo completo*</label><input type="text" id="endereco" required />
  <label>CRN ou CRM (opcional)</label><input type="text" id="crm" />
  <label>WhatsApp*</label><input type="text" id="whatsapp" placeholder="(99) 99999-9999" required />
  <label>Email*</label><input type="email" id="email" required />
  <div id="promoContainer"></div>

  <div style="text-align:center; margin-top: 25px;">
    <button onclick="mostrarContrato()">üìÑ Ver Contrato e Aceitar</button>
  </div>
  <button id="botaoEnviar" onclick="enviarFormulario()" style="display:none;">‚úÖ Enviar Dados</button>
  <div id="status"></div>
</div>

<div id="modalContrato">
  <div class="modal-content">
    <h3>üìÑ Contrato de Presta√ß√£o de Servi√ßos - NutriPrime</h3>
    <div id="contratoTexto"></div>
    <label style="margin-top:10px;"><input type="checkbox" id="aceiteCheckbox" /> Li e estou de acordo com os termos acima</label><br/>
    <button id="botaoAceitar" onclick="confirmarAceite()">‚úÖ Aceitar e continuar</button>
    <button onclick="fecharModal()" style="background:#ccc;color:#000;margin-left:10px;">‚ùå Cancelar</button>
  </div>
</div>

<script>
let dadosForm = {};
const promoAtiva = true;

// Preencher plano e IP
window.onload = () => {
  const promoDiv = document.getElementById("promoContainer");
  promoDiv.innerHTML = `
    <input type="hidden" id="plano" value="Plano B√°sico - R$ 44,90" />
    <p style="color:red;font-weight:bold;text-align:center;font-size:30px;margin-top:20px;">
      üéâ Voc√™ selecionou o Plano NUTRIPRIME PR√ì por R$ 44,90 mensais.
    </p>
  `;
  dadosForm.plano = "NUTRIPRIME PR√ì - R$ 44,90";
  fetch("https://api.ipify.org?format=json").then(r => r.json()).then(d => dadosForm.ip = d.ip).catch(()=> dadosForm.ip="IP n√£o dispon√≠vel");
};

const textoContratoBase = `CONTRATO DE PRESTA√á√ÉO DE SERVI√áOS ‚Äì SISTEMA NUTRIPRIME
CONTRATANTE: {{NOME CLIENTE}}, CPF/CNPJ: {{DOC CLIENTE}}, Endere√ßo: {{ENDERECO CLIENTE}}, CRM/CRN: {{CRM_CRN}}
PLANO: {{PLANO ESCOLHIDO}}, Valor: {{VALOR PLANO}}, Forma: {{FORMA PAGAMENTO}}, Data: {{DATA}}`;

function mostrarContrato() {
  const nome = document.getElementById("nome").value.trim();
  const documento = document.getElementById("documento").value.trim();
  const endereco = document.getElementById("endereco").value.trim();
  const crm = document.getElementById("crm").value.trim() || "n√£o informado";
  const plano = dadosForm.plano || "Plano Pro Promocional - R$ 34,90";
  if(!nome||!documento||!endereco){alert("Preencha nome, documento e endere√ßo.");return;}
  let contratoPersonalizado = textoContratoBase
    .replace(/{{NOME CLIENTE}}/g,nome)
    .replace(/{{DOC CLIENTE}}/g,documento)
    .replace(/{{ENDERECO CLIENTE}}/g,endereco)
    .replace(/{{CRM_CRN}}/g,crm)
    .replace(/{{PLANO ESCOLHIDO}}/g,plano)
    .replace(/{{VALOR PLANO}}/g,plano.match(/R\$ *[\d,\.]+/)?plano.match(/R\$ *[\d,\.]+/)[0]:"")
    .replace(/{{FORMA PAGAMENTO}}/g,"Boleto / Cart√£o (definir)")
    .replace(/{{DATA}}/g,new Date().toLocaleDateString("pt-BR"));
  document.getElementById("contratoTexto").innerText = contratoPersonalizado;
  dadosForm = {...dadosForm,nome,documento,endereco,crm,plano};
  document.getElementById("modalContrato").style.display="block";
  const checkbox = document.getElementById("aceiteCheckbox");
  checkbox.checked=false; document.getElementById("botaoAceitar").style.display="none";
  const divContrato = document.getElementById("contratoTexto"); divContrato.scrollTop=0;
  divContrato.removeEventListener("scroll", onScrollContrato);
  divContrato.addEventListener("scroll", onScrollContrato);
  function onScrollContrato(){if(divContrato.scrollTop+divContrato.clientHeight>=divContrato.scrollHeight-2){document.getElementById("botaoAceitar").style.display="block";divContrato.removeEventListener("scroll",onScrollContrato);}}
}

function confirmarAceite(){const checkbox=document.getElementById("aceiteCheckbox");if(!checkbox.checked){alert("Voc√™ precisa aceitar os termos.");return;}dadosForm.aceite="SIM";document.getElementById("modalContrato").style.display="none";document.getElementById("botaoEnviar").style.display="block";}

function fecharModal(){document.getElementById("modalContrato").style.display="none";}

function enviarFormulario(){
  if(dadosForm.aceite!=="SIM"){alert("Aceite o contrato antes de enviar.");return;}
  dadosForm.email=document.getElementById("email").value.trim();
  dadosForm.whatsapp=document.getElementById("whatsapp").value.trim();
  dadosForm.crm=document.getElementById("crm").value.trim();
  if(!dadosForm.nome||!dadosForm.email||!dadosForm.whatsapp){alert("Preencha todos os campos.");return;}
  const status=document.getElementById("status"); status.innerText="Enviando...";
  const botaoEnviar=document.getElementById("botaoEnviar"); botaoEnviar.disabled=true; botaoEnviar.innerText="Enviando...";
  
  fetch("https://script.google.com/macros/s/AKfycbx_scrRjnChIyaVaop82oEblRDL3uhJ0IOkPKBKNEhrjJZXxZDMxdJgSKqK45I98RmeRA/exec", { 
    method:"POST",
    body: JSON.stringify(dadosForm),
    headers: {"Content-Type":"application/json"}
  })
  .then(r=>r.json())
  .then(res=>{status.innerText=res.status||"Contrato enviado!"; botaoEnviar.style.display="none";})
  .catch(err=>{alert("Erro ao enviar: "+err.message); botaoEnviar.disabled=false; botaoEnviar.innerText="‚úÖ Enviar Dados";});
}
</script>
</body>
</html>

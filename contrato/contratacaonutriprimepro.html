<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contrata√ß√£o NutriPrime</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f3f9f4;
      margin: 0;
      padding: 20px;
    }
    .form-box {
      max-width: 700px;
      margin: 0 auto;
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      border-left: 10px solid #81c784;
      border-right: 10px solid #81c784;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
    }
    h2 { color: #2e7d32; text-align: center; }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
      color: #2e7d32;
      font-size: 14px;
    }
    input, select {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      margin-top: 5px;
      border: 1.5px solid #c8e6c9;
      border-radius: 8px;
      box-sizing: border-box;
    }
    button {
      background-color: #66bb6a;
      color: #fff;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      padding: 15px 20px;
      font-size: 20px;
      cursor: pointer;
      margin-top: 25px;
      width: 100%;
    }
    button:hover { background-color: #43a047; }
    .payment-link { margin-top: 30px; text-align: center; }
    .payment-link a {
      background: #ffd54f;
      color: #333;
      padding: 15px 25px;
      text-decoration: none;
      font-weight: bold;
      border-radius: 8px;
      display: inline-block;
    }
    #modalContrato {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.6);
      z-index: 9999;
    }
    .modal-content {
      background: #fff;
      margin: 5% auto;
      padding: 20px 30px;
      width: 90%;
      max-width: 800px;
      border-radius: 8px;
      max-height: 80vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    #contratoTexto {
      flex: 1 1 auto;
      overflow-y: auto;
      padding-right: 15px;
      border: 1px solid #ccc;
      border-radius: 6px;
      margin-bottom: 15px;
      white-space: pre-wrap;
      font-size: 14px;
      line-height: 1.5;
    }
    #botaoAceitar { display: none; flex-shrink: 0; }
    #status { text-align: center; margin-top: 20px; font-weight: bold; color: #2e7d32; }
    @media (max-width: 600px) {
      .form-box { padding: 20px; }
      button { font-size: 18px; padding: 12px 15px; }
    }
  </style>
</head>
<body>
  <div class="form-box">
    <h2>Finalizar Contrata√ß√£o NutriPrime</h2>
    <p style="text-align:center;">Preencha os dados abaixo e visualize o contrato antes de enviar.</p>

    <label>Nome completo*</label>
    <input type="text" id="nome" required />

    <label>CPF ou CNPJ*</label>
    <input type="text" id="documento" required />

    <label>Endere√ßo completo*</label>
    <input type="text" id="endereco" required />

    <label>CRN ou CRM (opcional)</label>
    <input type="text" id="crm" />

    <label>WhatsApp*</label>
    <input type="text" id="whatsapp" placeholder="(99) 99999-9999" required />

    <label>Email*</label>
    <input type="email" id="email" required />

    <div id="promoContainer"></div>

    <div style="text-align:center; margin-top: 25px;">
      <button onclick="mostrarContrato()">üìÑ Ver Contrato e Aceitar</button>
    </div>

    <button id="botaoEnviar" onclick="enviarFormulario()" style="display:none;">
      ‚úÖ Enviar Dados
    </button>

    <div id="status"></div>

    <div class="payment-link" id="linkPagamento" style="display:none;">
      <p>Ir para pagamento:</p>
      <a id="botaoPagamento" href="#" target="_blank">üí≥ Pagar</a>
    </div>
  </div>

  <div id="modalContrato">
    <div class="modal-content">
      <h3>üìÑ Contrato de Presta√ß√£o de Servi√ßos - NutriPrime</h3>
      <div id="contratoTexto"></div>
      <label style="margin-top: 10px;">
        <input type="checkbox" id="aceiteCheckbox" /> Li e estou de acordo com os termos
      </label><br />
      <button id="botaoAceitar" onclick="confirmarAceite()">‚úÖ Aceitar e continuar</button>
      <button onclick="fecharModal()" style="background:#ccc; color:#000; margin-left:10px;">‚ùå Cancelar</button>
    </div>
  </div>

  <script>
    let dadosForm = {};
    const promoAtiva = true;

    window.onload = () => {
      const promoDiv = document.getElementById("promoContainer");
      promoDiv.innerHTML = `
        <input type="hidden" id="plano" value="Plano B√°sico - R$ 44,90" />
        <p style="color:red; font-weight:bold; text-align:center; font-size:20px; margin-top:20px;">
          üéâ Voc√™ selecionou o Plano NUTRIPRIME PR√ì por R$ 44,90 mensais.
        </p>
      `;
      dadosForm.plano = "NUTRIPRIME PR√ì - R$ 44,90";

      fetch("https://api.ipify.org?format=json")
        .then(r => r.json())
        .then(data => dadosForm.ip = data.ip)
        .catch(() => dadosForm.ip = "IP n√£o dispon√≠vel");
    };

    const textoContratoBase = `
CONTRATO DE PRESTA√á√ÉO DE SERVI√áOS ‚Äì SISTEMA NUTRIPRIME

Pelo presente instrumento particular, de um lado:

CONTRATADA: VAGNER FRANCISCO BASTOS ALBUQUERQUE, inscrita no CNPJ sob o n¬∫ 61.124.508/0001-96, com sede em RUA S√ÉO PAULO, 814 - CABO FRIO/RJ, doravante denominada simplesmente CONTRATADA;

E, de outro lado:

CONTRATANTE: {{NOME CLIENTE}}, inscrito(a) no CPF/CNPJ sob o n¬∫ {{DOC CLIENTE}}, com endere√ßo em {{ENDERECO CLIENTE}}, portador(a) do registro profissional {{CRM_CRN}}, doravante denominado(a) simplesmente CONTRATANTE;

T√™m entre si, justas e contratadas, as seguintes cl√°usulas:

CL√ÅUSULA 1 ‚Äì OBJETO
1.1. O presente contrato tem como objeto a disponibiliza√ß√£o do sistema NutriPrime, uma plataforma digital de gest√£o e atendimento voltado para nutricionistas e profissionais da sa√∫de, incluindo ferramentas como agendamento, controle de clientes, planos alimentares, relat√≥rios e demais funcionalidades conforme plano contratado.

CL√ÅUSULA 2 ‚Äì PRAZO DE VIG√äNCIA
2.1. O contrato ter√° vig√™ncia de 12 (doze) meses a partir da data de ativa√ß√£o do sistema.
2.2. Ap√≥s o t√©rmino do per√≠odo contratado, o CONTRATANTE poder√° renovar o contrato por igual per√≠odo mediante novo pagamento.
2.3. Caso n√£o haja manifesta√ß√£o por parte do CONTRATANTE at√© 5 (cinco) dias antes do vencimento, o acesso ao sistema ser√° suspenso automaticamente.

CL√ÅUSULA 3 ‚Äì VALORES E FORMA DE PAGAMENTO
3.1. Pela utiliza√ß√£o do sistema, o CONTRATANTE pagar√° √† CONTRATADA o valor de {{VALOR PLANO}} mensais, conforme plano {{PLANO ESCOLHIDO}}, da seguinte forma: {{FORMA PAGAMENTO}}.
3.2. A CONTRATADA poder√° oferecer um per√≠odo de teste gratuito de 7 (sete) dias, sem qualquer custo ao CONTRATANTE.

CL√ÅUSULA 4 ‚Äì OBRIGA√á√ïES DA CONTRATADA
4.1. Disponibilizar o acesso ao sistema conforme prazo acordado ap√≥s confirma√ß√£o do pagamento ou ativa√ß√£o do teste.
4.2. Oferecer suporte t√©cnico em hor√°rio comercial via e-mail ou WhatsApp.
4.3. Manter os dados do CONTRATANTE armazenados com seguran√ßa, em conformidade com a LGPD (Lei Geral de Prote√ß√£o de Dados).

CL√ÅUSULA 5 ‚Äì OBRIGA√á√ïES DO CONTRATANTE
5.1. Efetuar o pagamento conforme acordado.
5.2. Utilizar o sistema de forma √©tica e legal.
5.3. Informar qualquer erro, falha ou necessidade de suporte t√©cnico.

CL√ÅUSULA 6 ‚Äì CANCELAMENTO E REEMBOLSO
6.1. O contrato poder√° ser cancelado a qualquer momento, por qualquer das partes, com aviso pr√©vio de 15 (quinze) dias.
6.2. Em caso de cancelamento por parte do CONTRATANTE, n√£o haver√° reembolso de valores j√° pagos, salvo acordos expressos por escrito.

CL√ÅUSULA 7 ‚Äì CONFIDENCIALIDADE
7.1. Ambas as partes comprometem-se a manter em sigilo todas as informa√ß√µes trocadas ou acessadas durante a vig√™ncia deste contrato.

CL√ÅUSULA 8 ‚Äì ACEITE ELETR√îNICO
8.1. O presente contrato poder√° ser aceito por meio eletr√¥nico, incluindo e-mail, WhatsApp ou outra forma digital de comunica√ß√£o.
8.2. O aceite por resposta do CONTRATANTE com a mensagem ‚ÄúLi e estou de acordo com os termos do contrato NutriPrime‚Äù ser√° considerado v√°lido e eficaz para todos os efeitos legais, com base no artigo 107 do C√≥digo Civil Brasileiro.
8.3. A CONTRATADA manter√° o registro do envio e do aceite como comprova√ß√£o da manifesta√ß√£o de vontade do CONTRATANTE.

CL√ÅUSULA 9 ‚Äì FORO
9.1. As partes elegem o foro da Comarca de Cabo Frio/RJ, renunciando a qualquer outro, por mais privilegiado que seja.

Cabo Frio/RJ, {{DATA}}
`;

    function mostrarContrato() {
      const nome = document.getElementById("nome").value.trim();
      const documento = document.getElementById("documento").value.trim();
      const endereco = document.getElementById("endereco").value.trim();
      const crm = document.getElementById("crm").value.trim() || "n√£o informado";
      const plano = dadosForm.plano || "Plano Pro Promocional - R$ 34,90";

      if (!nome || !documento || !endereco) {
        alert("Preencha nome, documento e endere√ßo antes de continuar.");
        return;
      }

      let contratoPersonalizado = textoContratoBase
        .replace(/{{NOME CLIENTE}}/g, nome)
        .replace(/{{DOC CLIENTE}}/g, documento)
        .replace(/{{ENDERECO CLIENTE}}/g, endereco)
        .replace(/{{CRM_CRN}}/g, crm)
        .replace(/{{PLANO ESCOLHIDO}}/g, plano)
        .replace(/{{VALOR PLANO}}/g, plano.match(/R\$ *[\d,\.]+/) ? plano.match(/R\$ *[\d,\.]+/)[0] : "")
        .replace(/{{FORMA PAGAMENTO}}/g, "Boleto / Cart√£o (definir)")
        .replace(/{{DATA}}/g, new Date().toLocaleDateString("pt-BR"));

      document.getElementById("contratoTexto").innerText = contratoPersonalizado;

      dadosForm = { ...dadosForm, nome, documento, endereco, crm, plano };
      document.getElementById("modalContrato").style.display = "block";

      document.getElementById("aceiteCheckbox").checked = false;
      document.getElementById("botaoAceitar").style.display = "none";

      const divContrato = document.getElementById("contratoTexto");
      divContrato.scrollTop = 0;
      divContrato.removeEventListener("scroll", onScrollContrato);
      divContrato.addEventListener("scroll", onScrollContrato);

      function onScrollContrato() {
        if (divContrato.scrollTop + divContrato.clientHeight >= divContrato.scrollHeight - 2) {
          document.getElementById("botaoAceitar").style.display = "block";
          divContrato.removeEventListener("scroll", onScrollContrato);
        }
      }
    }

    function confirmarAceite() {
      const checkbox = document.getElementById("aceiteCheckbox");
      if (!checkbox.checked) { alert("Voc√™ precisa aceitar os termos."); return; }
      dadosForm.aceite = "SIM";
      document.getElementById("modalContrato").style.display = "none";
      document.getElementById("botaoEnviar").style.display = "block";
      document.getElementById("linkPagamento").style.display = "none";
    }

    function fecharModal() { document.getElementById("modalContrato").style.display = "none"; }

    function enviarFormulario() {
      if (dadosForm.aceite !== "SIM") { alert("Aceite o contrato antes de enviar."); return; }
      dadosForm.email = document.getElementById("email").value.trim();
      dadosForm.whatsapp = document.getElementById("whatsapp").value.trim();
      dadosForm.crm = document.getElementById("crm").value.trim();

      if (!dadosForm.nome || !dadosForm.email || !dadosForm.whatsapp) {
        alert("Preencha todos os campos obrigat√≥rios."); return;
      }

      const statusDiv = document.getElementById("status");
      statusDiv.innerText = "Enviando...";
      const botaoEnviar = document.getElementById("botaoEnviar");
      botaoEnviar.disabled = true;
      botaoEnviar.innerText = "Enviando...";

      google.script.run
        .withSuccessHandler(resposta => {
          statusDiv.innerText = resposta;
          botaoEnviar.style.display = "none";
        })
        .withFailureHandler(erro => {
          alert("Erro ao enviar os dados: " + erro.message);
          botaoEnviar.disabled = false;
          botaoEnviar.innerText = "‚úÖ Enviar Dados";
        })
        .salvarContratacao(dadosForm);
    }
  </script>
</body>
</html>


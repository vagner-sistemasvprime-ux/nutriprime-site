<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Contratação NutriPrime</title>
<style>
body{font-family:sans-serif;background:#f3f9f4;padding:20px;}
.form-box{max-width:700px;margin:0 auto;background:#fff;padding:30px;border-radius:12px;border-left:10px solid #81c784;border-right:10px solid #81c784;box-shadow:0 6px 20px rgba(0,0,0,.1);}
h2{text-align:center;color:#2e7d32;}
label{display:block;margin-top:15px;font-weight:bold;color:#2e7d32;}
input,select{width:100%;padding:12px;margin-top:5px;border:1.5px solid #c8e6c9;border-radius:8px;box-sizing:border-box;font-size:16px;}
button{background:#66bb6a;color:#fff;border:none;border-radius:8px;padding:15px 20px;font-size:20px;cursor:pointer;margin-top:25px;width:100%;}
button:hover{background:#43a047;}
#status{text-align:center;margin-top:20px;font-weight:bold;color:#2e7d32;}
.payment-link{margin-top:30px;text-align:center;}
.payment-link a{background:#ffd54f;color:#333;padding:15px 25px;text-decoration:none;font-weight:bold;border-radius:8px;display:inline-block;}

/* Modal contrato */
.modal {
  display:none;
  position:fixed;
  z-index:9999;
  left:0; top:0;
  width:100%; height:100%;
  overflow:auto;
  background-color: rgba(0,0,0,0.6);
}
.modal-content {
  background:#fff;
  margin:50px auto;
  padding:20px;
  border-radius:12px;
  max-width:800px;
  max-height:80%;
  overflow-y:auto;
}
.modal-header{display:flex;justify-content:space-between;align-items:center;}
.modal-header h3{margin:0;}
.close-btn{cursor:pointer;font-size:24px;font-weight:bold;color:#444;}
</style>
</head>
<body>

<div class="form-box">
<h2>Formulário de Contratação</h2>
<label>Nome completo</label>
<input type="text" id="nome" required>

<label>Documento (CPF/RG)</label>
<input type="text" id="documento" required>

<label>Endereço</label>
<input type="text" id="endereco" required>

<label>CRN/CRM</label>
<input type="text" id="crm">

<label>Whatsapp</label>
<input type="text" id="whatsapp">

<label>E-mail</label>
<input type="email" id="email">

<label>Plano</label>
<select id="plano">
  <option value="Plano Básico - R$ 34,90">Plano Básico - R$ 34,90</option>
  <option value="Plano Pro - R$ 49,90">Plano Pro - R$ 49,90</option>
  <option value="Plano Pro Promocional - R$ 34,90">Plano Pro Promocional - R$ 34,90</option>
</select>

<button onclick="mostrarContrato()">Visualizar Contrato</button>
<div id="status"></div>
<div class="payment-link" id="paymentLink"></div>
</div>

<!-- Modal do contrato -->
<div class="modal" id="modalContrato">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Contrato NutriPrime</h3>
      <span class="close-btn" onclick="fecharContrato()">&times;</span>
    </div>
    <div id="conteudoContrato" style="margin-top:15px;line-height:1.5;"></div>
    <button onclick="confirmarContrato()" style="margin-top:20px;background:#4CAF50;width:100%;">Confirmar Contrato</button>
  </div>
</div>

<script>
// Geração do contrato HTML com placeholders
function gerarContratoHTML(dados){
  const valorPlano = dados.plano.match(/R\$ *[\d,\.]+/)? dados.plano.match(/R\$ *[\d,\.]+/)[0] : '';
  const hoje = new Date();
  const dataHoje = hoje.toLocaleDateString('pt-BR');
  const horaAgora = hoje.toLocaleTimeString('pt-BR');

  return `
<h4>Contrato de Prestação de Serviços - Sistema NutriPrime</h4>
<p>Cliente: <b>${dados.nome}</b></p>
<p>Documento: <b>${dados.documento}</b></p>
<p>Endereço: <b>${dados.endereco}</b></p>
<p>CRN/CRM: <b>${dados.crm || 'N/A'}</b></p>
<p>Plano escolhido: <b>${dados.plano}</b> (Valor: <b>${valorPlano}</b>)</p>
<p>Data de contratação: ${dataHoje} às ${horaAgora}</p>
<p>Whatsapp: ${dados.whatsapp}<br>Email: ${dados.email}</p>
<hr>
<p>Declaro que li, entendi e aceito todas as condições do contrato acima.</p>
<p><i>Assinatura digital ao confirmar.</i></p>
`;
}

function mostrarContrato(){
  const dados = {
    nome: document.getElementById('nome').value,
    documento: document.getElementById('documento').value,
    endereco: document.getElementById('endereco').value,
    crm: document.getElementById('crm').value,
    whatsapp: document.getElementById('whatsapp').value,
    email: document.getElementById('email').value,
    plano: document.getElementById('plano').value,
    ip: '' // opcional: usar serviço para IP
  };

  if(!dados.nome || !dados.documento || !dados.endereco || !dados.email){
    alert('Preencha todos os campos obrigatórios!');
    return;
  }

  const conteudo = gerarContratoHTML(dados);
  document.getElementById('conteudoContrato').innerHTML = conteudo;
  document.getElementById('modalContrato').style.display = 'block';
}

function fecharContrato(){
  document.getElementById('modalContrato').style.display = 'none';
}

// Envia contrato ao clicar Confirmar
async function confirmarContrato(){
  const statusDiv = document.getElementById('status');
  const paymentDiv = document.getElementById('paymentLink');
  statusDiv.innerText = 'Enviando...';
  paymentDiv.innerHTML = '';
  const modal = document.getElementById('modalContrato');

  const dados = {
    nome: document.getElementById('nome').value,
    documento: document.getElementById('documento').value,
    endereco: document.getElementById('endereco').value,
    crm: document.getElementById('crm').value,
    whatsapp: document.getElementById('whatsapp').value,
    email: document.getElementById('email').value,
    plano: document.getElementById('plano').value,
    ip: ''
  };

  try {
    const res = await fetch('https://script.google.com/macros/s/SEU_ID_WEBAPP/exec',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(dados)
    });
    const json = await res.json();

    if(json.status === "ok"){
      statusDiv.innerText = json.message;
      if(json.linkPagamento){
        paymentDiv.innerHTML = `<a href="${json.linkPagamento}" target="_blank">Clique aqui para pagar seu plano</a>`;
      }
      modal.style.display = 'none';
    }else{
      statusDiv.innerText = 'Erro ao enviar formulário.';
    }
  } catch(e){
    console.error(e);
    statusDiv.innerText = 'Erro de conexão. Tente novamente.';
  }
}

// Fechar modal ao clicar fora
window.onclick = function(event){
  const modal = document.getElementById('modalContrato');
  if(event.target === modal){
    modal.style.display = 'none';
  }
}
</script>
</body>
</html>
